#!/bin/sh
#
# Run specs with zeus if running; Fallback to plain old rspec.
#
gemset=$(grep ruby-gemset Gemfile | sed 's/#ruby-gemset=//')

# This requires ruby to be run under rvm.
# The zeus process command will show up in `ps aux` as:
#   /home/ryan/.rvm/gems/ruby-2.3.3@asciinote/gems/zeus-0.15.14/build/zeus-linux-amd64 start
# This regexp attempts to find the correct process using "$gemset*zeus".
pgrep -f "$gemset.*zeus" > /dev/null

if [ $? -eq 0 ]; then
  echo "zeus rspec $@"
  zeus rspec $@
else
  bundle exec rspec $@
fi
